import asyncio
import os
from dotenv import load_dotenv
from aiogram.filters import Command
from aiogram import Bot, Dispatcher
import logging


def generate_content(prompt):
    import requests


# ‚úÖ –õ–û–ì–ò –í–ö–õ–Æ–ß–ï–ù–´
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)
print("üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ .env...")

load_dotenv()
TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN")
PPLX_API_KEY = os.getenv("PPLX_API_KEY")

print(f"‚úÖ TELEGRAM_TOKEN: {'OK' if TELEGRAM_TOKEN else '‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢'}")
print(f"‚úÖ PPLX_API_KEY: {'OK' if PPLX_API_KEY else '‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢'}")

bot = Bot(token=TELEGRAM_TOKEN)
dp = Dispatcher()
print("ü§ñ Bot –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")

# Base URL for Perplexity API
api_url = "https://api.perplexity.ai/generate"

 # Headers for the API request
 headers = {
      "Authorization": "Bearer your_api_key_here",  # Replace with valid API key
      "Content-Type": "application/json"
      }

  # Payload for the API request (Adapt as per Perplexity's API schema)
  data = {
       "prompt": prompt
       }

   try:
        response = requests.post(api_url, headers=headers, json=data)
        response.raise_for_status()
        result = response.json()

        if 'content' in result:
            return result['content']
        else:
            raise ValueError(
                "Invalid response format received from Perplexity API.")

    except requests.exceptions.RequestException as e:
        raise RuntimeError(f"Request to Perplexity API failed: {e}")

    except ValueError as e:
        raise RuntimeError(
            f"Error processing the Perplexity API response: {e}")
